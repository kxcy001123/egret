var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function s(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}(),BasicComponent=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setSkinName=function(t){this.addEventListener(eui.UIEvent.COMPLETE,this.onComplete,this),this.skinName=t},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.isCreateChildren=!0,this.init()},e.prototype.onComplete=function(){this.isLoadComplete=!0,this.init()},e.prototype.init=function(){this.isCreateChildren&&this.isLoadComplete&&this.render()},e.prototype.render=function(){},e.prototype.createBitmapByName=function(t,e){void 0===e&&(e=null);var n=new egret.Bitmap,s=RES.getRes(t);return n.texture=s,null!=e&&(n.scale9Grid=e),n},e.prototype.addKeyboardEvent=function(t,e){document.addEventListener(t,function(n){e&&e({type:t,keyCode:n.keyCode})})},e}(eui.Component);__reflect(BasicComponent.prototype,"BasicComponent");var MyPanel=function(t){function e(){var e=t.call(this)||this,n=new StartPanel;return e.addChild(n),e}return __extends(e,t),e}(eui.UILayer);__reflect(MyPanel.prototype,"MyPanel");var StartPanel=function(t){function e(){var e=t.call(this)||this;return e.score=0,e.conA=0,e.sinA=0,e.dis=0,e.bullets=[],e.enemys=[],e.point=new egret.Point,e.setSkinName("resource/eui_skins/APP_GameSkin.exml"),e}return __extends(e,t),e.prototype.render=function(){var t=this;this.initSount(),SystemSetManager.getIns().initData(),this.controlBar.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),this.controlBg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),this.btnFire.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),this.btnSet.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.addChild(t.setPanel)},this),egret.startTick(this.loop,this),this.addEnemy(),this.txtScore.text=Const.VER,this.setPanel=new SetPanel,this.setPanel.backFunction=this.backFunction.bind(this),this.backFunction()},e.prototype.backFunction=function(){this.showView()},e.prototype.initSount=function(){SoundControl.getIns().addItem("fire_mp3"),SoundControl.getIns().addItem("bomb_mp3"),SoundControl.getIns().addItem("bgSound2_mp3",!0),SoundControl.getIns().play("bgSound2_mp3",0,99),SoundControl.getIns().setBgVolume(Const.SOUND_BG),SoundControl.getIns().setEffectVolume(Const.SOUND_EFFECT)},e.prototype.showView=function(){var t=SystemSetManager.getIns().getData().showShip;this.airship.visible=t},e.prototype.loop=function(t){this.isMoveMap&&this.controlAirMap();for(var e=this.bullets,n=this.enemys,s=(this.aim,0);s<e.length;s++){var o=e[s],i=o.targetY-o.y,r=o.targetX-o.x;if(o.y+=i/5,o.x+=r/5,Math.abs(i)<1){for(var a=0;a<n.length;a++){var h=n[a];h.checkHit(o)}this.container.removeChild(o),e.splice(s,1),s--}}for(Math.random()<.01&&this.addEnemy(),s=0;s<n.length;s++)h=n[s],h.loop();return!1},e.prototype.addEnemy=function(){if(this.enemys.length<Const.MAX_ENEMY){var t=new EnemyData("enemy_png");t.addEventListener(Const.REMOVE,this.removeEnemy,this),this.enemyContainer.addChild(t),this.enemys.push(t)}},e.prototype.removeEnemy=function(t){var e=t.currentTarget;e.removeEventListener(Const.REMOVE,this.removeEnemy,this),this.enemyContainer.removeChild(e),this.enemys.splice(this.enemys.indexOf(e),1),SoundControl.getIns().play("bomb_mp3"),this.score++,this.txtScore.text="scoreï¼š"+this.score},e.prototype.onTouch=function(t){0==t.touchPointID?t.currentTarget==this.btnFire?this.disposeFire(t):this.disposeControl(t):this.disposeFire(t)},e.prototype.disposeFire=function(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:this.fireStart();break;case egret.TouchEvent.TOUCH_END:case egret.TouchEvent.TOUCH_RELEASE_OUTSIDE:this.fireEnd()}},e.prototype.disposeControl=function(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:this.isMoveMap=!0,this.controlStart();break;case egret.TouchEvent.TOUCH_MOVE:this.controlMove(t.stageX,t.stageY);break;case egret.TouchEvent.TOUCH_END:this.isMoveMap=!1,this.controlEnd()}},e.prototype.controlStart=function(){this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouch,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this)},e.prototype.controlMove=function(t,e){this.point.x=t,this.point.y=e;var n=this.controlBg,s=this.controlBar,o=n.x,i=n.y,r=t-o,a=e-i,h=Math.sqrt(r*r+a*a),c=n.width>>1,u=r/h,l=a/h;c>h?(s.x=t,s.y=e,this.dis=h):(s.x=o+u*c,s.y=i+l*c,this.dis=c),this.conA=u,this.sinA=l,this.controlAirship(u,l)},e.prototype.controlEnd=function(){this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouch,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this);var t=this.controlBg,e=this.controlBar;e.x=t.x,e.y=t.y,this.aim.x=this.stage.stageWidth>>1,this.aim.y=this.stage.stageHeight>>1,this.airship.rotation=0},e.prototype.fireStart=function(){this.isFire=!0,this.sendBullet(),this.btnFire.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouch,this),this.btnFire.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this)},e.prototype.fireEnd=function(){this.isFire=!1,this.btnFire.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouch,this),this.btnFire.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this)},e.prototype.sendBullet=function(){if(this.isFire){if(SystemSetManager.getIns().getData().fireIsContinue){var t=1e3/SystemSetManager.getIns().getData().fireCount;egret.setTimeout(this.sendBullet,this,t)}else this.fireEnd();var e=new Buttlet("bullet_png");e.x=this.stage.stageWidth/2,e.y=this.stage.stageHeight,e.targetX=this.aim.x,e.targetY=this.aim.y,e.changeAngle(),e.anchorOffsetX=e.width>>1,this.container.addChild(e),this.bullets.push(e),SoundControl.getIns().play("fire_mp3")}},e.prototype.controlAirship=function(t,e){if(SystemSetManager.getIns().getData().turnShip){var n=this.airship,s=(this.controlBar.x-this.controlBg.x)/20;n.rotation=s}if(SystemSetManager.getIns().getData().aimIsMove){var o=this.aim,i=this.controlBar,r=this.controlBg,a=r.width/2,h=i.x-r.x,c=i.y-r.y,u=this.stage.stageWidth/2,l=this.stage.stageHeight/2;o.x=u+h/a*u,o.y=l+c/a*l}},e.prototype.controlAirMap=function(){if(SystemSetManager.getIns().getData().mapIsMove){var t=this.conA,e=this.sinA,n=this.dis,s=this.map,o=(this.controlBg,this.point,0),i=0,r=this.stage.stageWidth,a=this.stage.stageHeight,h=s.x,c=s.y;o>h?s.x=o:h>r?s.x=r:i>c?s.y=i:c>a?s.y=a:(s.x-=t*n*.03,s.y-=e*n*.03),this.enemyContainer.x=s.x,this.enemyContainer.y=s.y}},e}(BasicComponent);__reflect(StartPanel.prototype,"StartPanel");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function s(s){e.call(n,s,t)}if(RES.hasRes(t)){var o=RES.getRes(t);o?s(o):RES.getResAsync(t,s,this)}else RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isThemeLoadEnd=!1,e.isResourceLoadEnd=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},e.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.startCreateScene=function(){this.addChild(new MyPanel)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,s){function o(t){e.call(s,t)}function i(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),n.call(s))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var SetPanel=function(t){function e(){var e=t.call(this)||this;return e.soundChange=10,e.setSkinName("resource/eui_skins/APP_SetSkin.exml"),e}return __extends(e,t),e.prototype.render=function(){var t=this;this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.parent.removeChild(t)},this),this.soundBg.addEventListener(egret.Event.CHANGE,this.onChange,this),this.soundEffect.addEventListener(egret.Event.CHANGE,this.onChange,this),this.soundBg.value=Const.SOUND_BG*this.soundChange,this.soundEffect.value=Const.SOUND_EFFECT*this.soundChange,this.setTrackHighLight(this.soundBg),this.setTrackHighLight(this.soundEffect);for(var e=0;e<this.numChildren;e++){var n=this.getChildAt(e);n instanceof eui.ToggleButton&&(n.addEventListener(egret.Event.CHANGE,this.onToggleButton,this),this.changeUI(n,!0))}},e.prototype.setTrackHighLight=function(t){var e=this.createBitmapByName("track_sb_png");e.x=t.x,e.y=t.y+10,this.addChild(e),t.trackHighlight=e},e.prototype.onChange=function(t){0==this.soundIsNo.selected&&(this.soundIsNo.selected=!0);var e;t.currentTarget==this.soundBg?(e=this.soundBg.value,e/=this.soundChange,SoundControl.getIns().setBgVolume(e)):t.currentTarget==this.soundEffect&&(e=this.soundEffect.value,e/=this.soundChange,SoundControl.getIns().setEffectVolume(e))},e.prototype.onToggleButton=function(t){var e=t.currentTarget;this.changeUI(e),null!=this.backFunction&&this.backFunction()},e.prototype.changeUI=function(t,e){void 0===e&&(e=!1);var n=t.selected?1:0,s=t.selected,o=SystemSetManager.getIns().getData();switch(t.name){case"soundIsNo":e?t.selected=1==Const.SOUND_IS_NO:SoundControl.getIns().setIsNoVolume(n);break;case"turnShip":e?t.selected=o.turnShip:SystemSetManager.getIns().getData().turnShip=s;break;case"fireIsContinue":e?t.selected=o.fireIsContinue:SystemSetManager.getIns().getData().fireIsContinue=s;break;case"moveAim":e?t.selected=o.aimIsMove:SystemSetManager.getIns().getData().aimIsMove=s;break;case"moveMap":e?t.selected=o.mapIsMove:SystemSetManager.getIns().getData().mapIsMove=s;break;case"showShip":e?t.selected=o.showShip:SystemSetManager.getIns().getData().showShip=s}},e}(BasicComponent);__reflect(SetPanel.prototype,"SetPanel");var Buttlet=function(t){function e(e){var n=t.call(this)||this;return n.targetX=0,n.targetY=0,n.render(e),n}return __extends(e,t),e.prototype.render=function(t){this.skin=this.createBitmapByName(t),this.addChild(this.skin)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},e.prototype.changeAngle=function(){var t=this.targetX-this.x,e=this.targetY-this.y,n=Math.sqrt(t*t+e*e);this.rotation=t/n*180/Math.PI},e}(egret.Sprite);__reflect(Buttlet.prototype,"Buttlet");var Const=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.VER="1.6",e.REMOVE="remove",e.MAP_WIDTH=2272,e.MAP_HEIGHT=1280,e.CENTER_X=1136,e.CENTER_Y=640,e.MAX_ENEMY=10,e.SOUND_BG=.5,e.SOUND_EFFECT=.5,e.SOUND_IS_NO=1,e}(egret.HashObject);__reflect(Const.prototype,"Const");var EnemyData=function(t){function e(e){var n=t.call(this)||this;return n.vx=0,n.vy=0,n.blood=2,n.render(e),n}return __extends(e,t),e.prototype.render=function(t){this.skin=this.createBitmapByName(t),this.addChild(this.skin);var e=this.skin.width/2,n=this.skin.height/2;this.radius=Math.sqrt(e*e+n*n),this.skin.x=-e,this.skin.y=-n,this.x=Math.random()*Const.MAP_WIDTH,this.y=Math.random()*Const.MAP_HEIGHT,this.vx=4*Math.random(),this.vy=4*Math.random()},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},e.prototype.loop=function(){this.x+=this.vx,this.y+=this.vy;var t=this.x,e=this.y,n=0,s=Const.MAP_WIDTH,o=0,i=Const.MAP_HEIGHT;n>t?this.vx*=-1:t>s?this.vx*=-1:o>e?this.vy*=-1:e>i&&(this.vy*=-1)},e.prototype.checkHit=function(t){var e=this.parent.localToGlobal(this.x,this.y),n=t.x-e.x,s=t.y-e.y,o=Math.sqrt(n*n+s*s);o<this.radius&&(this.blood--,0==this.blood&&this.removeSelf())},e.prototype.removeSelf=function(){this.dispatchEvent(new egret.Event(Const.REMOVE))},e}(egret.Sprite);__reflect(EnemyData.prototype,"EnemyData");var SoundControl=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sounds={},e.channels={},e.volumeBg=Const.SOUND_BG,e.volumeEffect=Const.SOUND_EFFECT,e.isNoVolume=Const.SOUND_IS_NO,e}return __extends(e,t),e.getIns=function(){return null==this.instance&&(this.instance=new e),this.instance},e.prototype.checkSoundIsBg=function(t,e){return t[e+"-bg"]},e.prototype.addItem=function(t,e){void 0===e&&(e=!1);var n=t;if(e&&(n=t+"-bg"),!this.sounds[n]){var s=RES.getRes(t);this.sounds[n]=s}},e.prototype.play=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=1);var s=this.volumeEffect;if(this.checkSoundIsBg(this.sounds,t)&&(t+="-bg",s=this.volumeBg),this.sounds[t]){var o=this.sounds[t];this.channels[t]=o.play(e,n),0==this.isNoVolume?this.channels[t].volume=0:this.channels[t].volume=s}},e.prototype.stop=function(t){if(this.checkSoundIsBg(this.channels,t)&&(t+="-bg"),this.channels[t]){var e=this.channels[t];e.stop()}},e.prototype.setVolume=function(t,e){if(this.checkSoundIsBg(this.channels,t)&&(t+="-bg"),this.channels[t]){var n=this.channels[t];n.volume=e}},e.prototype.setBgVolume=function(t){for(var e in this.channels)if(2==e.split("-bg").length){var n=this.channels[e];this.volumeBg=t,0!=n.position&&(n.volume=t)}},e.prototype.setEffectVolume=function(t){for(var e in this.channels)if(1==e.split("-bg").length){var n=this.channels[e];this.volumeEffect=t,0!=n.position&&(n.volume=t)}},e.prototype.setIsNoVolume=function(t){this.isNoVolume=t;for(var e in this.channels){var n=this.channels[e];0!=n.position&&(0==t?n.volume=0:this.checkSoundIsBg(this.sounds,e)?n.volume=this.volumeBg:n.volume=this.volumeEffect)}},e}(egret.HashObject);__reflect(SoundControl.prototype,"SoundControl");var SystemSetManager=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.getIns=function(){return null==this.instance&&(this.instance=new e),this.instance},e.prototype.initData=function(){this.data=new SystemData},e.prototype.getData=function(){return this.data},e}(egret.HashObject);__reflect(SystemSetManager.prototype,"SystemSetManager");var SystemData=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fireIsContinue=!0,e.fireCount=5,e.soundIsNo=1,e.soundEffectVolume=1,e.soundBackgroundVolume=1,e.turnShip=!1,e.showShip=!1,e.aimIsMove=!0,e.mapIsMove=!1,e}return __extends(e,t),e}(egret.HashObject);__reflect(SystemData.prototype,"SystemData");